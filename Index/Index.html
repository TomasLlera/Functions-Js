<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student List</title>
    <style>
        /* Modal Styles */
        #editModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 400px;
            margin: 100px auto;
            text-align: center;
        }

        .modal-content input {
            margin: 10px;
            padding: 8px;
            width: 90%;
        }

        .modal-buttons button {
            margin: 5px;
            padding: 8px 15px;
        }
    </style>
</head>

<body>
    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
            <tr>
                <td></td>
                <td><input id="firstName" placeholder="First Name" /></td>
                <td><input id="lastName" placeholder="Last Name" /></td>
                <td><button onclick="addStudent()">ADD</button></td>
            </tr>
        </tfoot>
    </table>
    <button onclick="getStudents()">Refresh List</button>

    <!-- Edit Student Modal -->
    <div id="editModal">
        <div class="modal-content">
            <h3>Edit Student</h3>
            <input type="text" id="editFirstName" placeholder="First Name" />
            <input type="text" id="editLastName" placeholder="Last Name" />
            <div class="modal-buttons">
                <button onclick="confirmEdit()">Save</button>
                <button onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        const url = 'https://681cdcfaf74de1d219ae0c04.mockapi.io';

        let currentEditId = null;
        let currentRow = null;

        function studentsLoad() {
            return new Promise((resolve, reject) => {
                const request = new XMLHttpRequest();
                request.open('GET', `${url}/students`);
                request.responseType = 'json';
                request.onload = () => request.status === 200 ? resolve(request.response) : reject(new Error(request.responseText));
                request.onerror = () => reject(new Error('Network error.'));
                request.send();
            });
        }

        function studentsSave() {
            return new Promise((resolve, reject) => {
                const request = new XMLHttpRequest();
                request.open('POST', `${url}/students`);
                request.setRequestHeader('Content-Type', 'application/json');

                const student = JSON.stringify({
                    firstName: document.getElementById('firstName').value.trim(),
                    lastName: document.getElementById('lastName').value.trim()
                });

                request.onload = () => request.status === 201 ? resolve(request.responseText) : reject(new Error(request.responseText));
                request.onerror = () => reject(new Error('Network error.'));
                request.send(student);
            });
        }

        function studentsDelete(id) {
            return new Promise((resolve, reject) => {
                const request = new XMLHttpRequest();
                request.open('DELETE', `${url}/students/${id}`);
                request.onload = () => request.status === 200 ? resolve('Deleted') : reject(new Error(request.responseText));
                request.onerror = () => reject(new Error('Error deleting student.'));
                request.send();
            });
        }

        function studentsUpdate(id, updatedStudent) {
            return new Promise((resolve, reject) => {
                const request = new XMLHttpRequest();
                request.open('PUT', `${url}/students/${id}`);
                request.setRequestHeader('Content-Type', 'application/json');
                request.onload = () => request.status === 200 ? resolve(request.responseText) : reject(new Error(request.responseText));
                request.onerror = () => reject(new Error('Error updating student.'));
                request.send(JSON.stringify(updatedStudent));
            });
        }

        function getStudents() {
            studentsLoad().then(response => {
                const tbody = document.querySelector('tbody');
                tbody.innerHTML = '';
                response.forEach(student => insertTr(student));
            }).catch(console.error);
        }

        function addStudent() {
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();

            if (firstName && lastName) {
                studentsSave().then(response => {
                    insertTr(JSON.parse(response));
                    document.getElementById('firstName').value = '';
                    document.getElementById('lastName').value = '';
                }).catch(console.error);
            } else {
                alert("Please complete both fields.");
            }
        }

        function deleteStudent(id, row) {
            if (confirm("Delete student?")) {
                studentsDelete(id).then(() => row.remove()).catch(console.error);
            }
        }

        function showEditModal(student, row) {
            currentEditId = student.id;
            currentRow = row;

            document.getElementById('editFirstName').value = student.firstName;
            document.getElementById('editLastName').value = student.lastName;
            document.getElementById('editModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditId = null;
            currentRow = null;
        }

        function confirmEdit() {
            const updated = {
                firstName: document.getElementById('editFirstName').value.trim(),
                lastName: document.getElementById('editLastName').value.trim()
            };

            if (!updated.firstName || !updated.lastName) {
                alert("Empty fields are not allowed.");
                return;
            }

            studentsUpdate(currentEditId, updated).then(response => {
                const student = JSON.parse(response);
                currentRow.innerHTML = `
                    <td>${student.id}</td>
                    <td>${student.firstName}</td>
                    <td>${student.lastName}</td>
                    <td>
                        <button onclick='showEditModal(${JSON.stringify(student)}, this.parentNode.parentNode)'>Edit</button>
                        <button onclick='deleteStudent("${student.id}", this.parentNode.parentNode)'>Delete</button>
                    </td>
                `;
                closeModal();
            }).catch(console.error);
        }

        function insertTr(student) {
            const tbody = document.querySelector('tbody');
            const tr = document.createElement('tr');

            tr.innerHTML = `
                <td>${student.id}</td>
                <td>${student.firstName}</td>
                <td>${student.lastName}</td>
                <td>
                    <button onclick='showEditModal(${JSON.stringify(student)}, this.parentNode.parentNode)'>Edit</button>
                    <button onclick='deleteStudent("${student.id}", this.parentNode.parentNode)'>Delete</button>
                </td>
            `;

            tbody.appendChild(tr);
        }

        window.onload = getStudents;
    </script>
</body>

</html>
